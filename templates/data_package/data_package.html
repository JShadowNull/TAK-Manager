{% extends "components/base.html" %}
{% from "components/button.html" import create_button %}
{% from "components/search_bar.html" import create_search_bar %}

{% block title %}Data Package Configuration{% endblock %}

{% block content %}
    {% set title = 'Data Package Configuration' %}
    {% include 'components/title_bar.html' %}
    <div class="flex flex-col gap-8 pt-14">

        <!-- Data Package Name Section -->
        <div class="border border-accentBoarder bg-cardBg p-4 rounded-lg w-full max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-base font-bold top-0">Zip File Name</h3>
            </div>
            <div class="space-y-4 zip-file-name-container">
                {% with %}
                    {% set name = "Enter Zip File Name without .zip extension" %}
                    {% set input_type = "text" %}
                    {% set id = "zip-file-name" %}
                    {% set placeholder = "Username" %}
                    {% set show_checkbox = false %}
                    {% set show_label = false%}
                    {% include "data_package/preference_item.html" %}
                {% endwith %}
            </div>
        </div>
        <!-- CoT Streams Section -->
        <div class="border border-accentBoarder p-4 bg-cardBg rounded-lg w-full max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-base font-bold top-0">CoT Streams</h3>
                <div class="flex gap-2">
                    {{ create_button(
                        text="Select All",
                        hover_color="green",
                        additional_classes="select-all-btn",
                        data_attributes={"section": "cot-streams"}
                    ) }}
                    {{ create_button(
                        text="Unselect All",
                        hover_color="red",
                        additional_classes="unselect-all-btn",
                        data_attributes={"section": "cot-streams"}
                    ) }}
                </div>
            </div>
            <div class="space-y-4 cot-streams-container">
                {% include "data_package/cot_item.html" %}   
            </div>
        </div>

        <!-- Application Preferences Section -->
        <div class="border border-accentBoarder bg-cardBg p-4 rounded-lg w-full max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-base font-bold top-0">Application Preferences</h3>
                {{ create_search_bar(id="app-prefs-search", placeholder="Search preferences...") }}
                <div class="flex gap-2">
                    {{ create_button(
                        text="Select All",
                        hover_color="green",
                        additional_classes="select-all-btn",
                        data_attributes={"section": "app-prefs"}
                    ) }}
                    {{ create_button(
                        text="Unselect All",
                        hover_color="red",
                        additional_classes="unselect-all-btn",
                        data_attributes={"section": "app-prefs"}
                    ) }}
                </div>
            </div>
            <div class="space-y-4 app-prefs-container">
                {% include "data_package/application_prefs.html" %}
            </div>
        </div>
    </div>
    <div class="flex justify-center mt-4">
        <button id="configure-data-package-btn" 
            class="text-buttonTextColor rounded-lg p-2 text-sm border-1 border-buttonBorder bg-buttonColor hover:text-black hover:shadow-soft hover:border-black hover:shadow-black hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled>
            Create Data Package
        </button>
    </div>

    <!-- Data Package Creation Popup -->
    {% set popup_id = 'popup-configure-data-package' %}
    {% set title = 'Create Data Package' %}
    {% set show_terminal = True %}
    {% set content_html = '''
    <!-- Step 1: Terminal Output -->
    <div id="data-package-step-1" class="data-package-step">
        <!-- Terminal output will be shown here -->
        <div id="popup-configure-data-package-terminal-output" class="terminal-output list-none space-y-2 overflow-y-auto text-textSecondary text-sm border border-accentBoarder h-64 p-2 rounded-lg mt-4">
            <!-- Terminal output will be appended here -->
        </div>
    </div>

    <!-- Step 2: Data Package Creation Success -->
    <div id="data-package-step-2" class="data-package-step hidden">
        <p class="mb-2 text-sm text-center">Data package creation successful! Your package is ready for use.</p>
    </div>
    ''' %}

    {% set buttons_html = '''
    <button id="popup-configure-data-package-close-btn" class="text-buttonTextColor rounded-lg p-2 text-sm border-1 border-buttonBorder bg-buttonColor hover:text-black hover:shadow-soft hover:border-black hover:shadow-black hover:bg-red-500">
        Close
    </button>
    <button id="popup-configure-data-package-stop-btn" class="text-buttonTextColor rounded-lg p-2 text-sm border-1 border-buttonBorder bg-buttonColor hover:text-black hover:shadow-soft hover:border-black hover:shadow-black hover:bg-red-500">
        Stop
    </button>
    <button id="popup-configure-data-package-next-btn" class="text-buttonTextColor rounded-lg p-2 text-sm border-1 border-buttonBorder bg-buttonColor hover:text-black hover:shadow-soft hover:border-black hover:shadow-black hover:bg-green-500">
        Next
    </button>
    ''' %}

    {% include 'components/popup_base.html' %}
{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <script src="{{ url_for('static', filename='js/data_package/data_package.js') }}"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
{% endblock %}
