{% extends "components/base.html" %}
{% from "components/button.html" import create_button %}

{% block title %}Transfer{% endblock %}

{% block content %}
    {% set title = 'Rapid Transfer' %}
    {% include 'components/title_bar.html' %}

    <div class="flex flex-col gap-6 p-8">
        <!-- File Upload Section -->
        <div class="bg-cardBg p-6 rounded-lg shadow-lg text-white border-1 border-accentBoarder">
            <h2 class="text-base mb-4">File Upload</h2>
            <div class="flex flex-col gap-4">
                <div class="border-2 border-dashed border-gray-400 rounded-lg p-6 text-center">
                    <input type="file" id="file-input" multiple class="hidden" accept=".zip,.jpg,.jpeg,.png,.tif,.tiff,.p12,.apk,.sid">
                    <label for="file-input" class="cursor-pointer">
                        <svg class="mx-auto h-4 w-4 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p class="mt-1">Drop files here or click to select</p>
                        <p class="text-sm text-gray-400">Supported files: .zip, .jpg, .jpeg, .png, .tif, .tiff, .p12, .apk, .sid</p>
                    </label>
                </div>
                <div id="file-list" class="hidden space-y-2 text-buttonTextColor rounded-lg p-2 text-sm border-1 border-buttonBorder bg-buttonColor"></div>
                <template id="file-item-template">
                    <div class="flex justify-between items-center p-2 rounded-lg">
                        <span class="text-buttonTextColor"></span>
                        <button class="text-red-500 hover:text-red-700 hover:shadow-soft" data-filename="">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </template>
            </div>
        </div>

        <!-- Transfer Status -->
        <div class="bg-cardBg p-6 rounded-lg shadow-lg text-white border-1 border-accentBoarder">
            <h2 class="text-base mb-4">Transfer Status</h2>
            <div class="space-y-4">
                <div class="flex items-center gap-4">
                    <span class="text-sm">Device Status:</span>
                    <span id="device-status" class="text-yellow-500 text-sm">Waiting for device...</span>
                </div>
                <div id="device-progress-container" class="space-y-4">
                    <!-- Progress bars will be inserted here -->
                </div>
                <template id="device-progress-template">
                    <div class="device-progress bg-buttonColor border-1 border-buttonBorder rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="device-label text-sm font-medium text-white"></span>
                            <span class="progress-text text-sm font-medium text-white">0%</span>
                        </div>
                        <div class="relative w-full h-2 bg-primaryBg rounded-full overflow-hidden">
                            <div class="progress-bar absolute top-0 left-0 h-full bg-blue-500 rounded-full transition-all duration-300 ease-in-out" style="width: 0%"></div>
                        </div>
                        <div class="flex flex-col gap-1 mt-2">
                            <span class="file-label text-sm text-textSecondary"></span>
                            <span class="status-label text-sm text-textSecondary"></span>
                        </div>
                    </div>
                </template>
                <div class="flex gap-4">
                    {{ create_button("Start Transfer", "green", "button", "start-transfer-btn") }}
                    {{ create_button("Stop Transfer", "red", "button", "stop-transfer-btn") }}
                </div>
            </div>
        </div>

        <!-- Transfer Log -->
        <div class="bg-cardBg p-6 rounded-lg shadow-lg text-white border-1 border-accentBoarder">
            <h2 class="text-xl mb-4">Transfer Log</h2>
            <div id="transfer-log" class="list-none space-y-2 overflow-y-auto text-textSecondary text-sm border border-accentBoarder h-64 p-2 rounded-lg mt-4">
                <!-- Log messages will be inserted here -->
            </div>
        </div>
    </div>

    <!-- ADB Installation Popup -->
    {% include 'transfer/adb_install.html' %}

{% endblock %}

{% block scripts %}
<!-- Add Socket.IO client library first -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<!-- Add hooks -->
<script src="{{ url_for('static', filename='js/templates/hooks/useModal.js') }}"></script>
<script src="{{ url_for('static', filename='js/templates/hooks/useSteps.js') }}"></script>
<script src="{{ url_for('static', filename='js/templates/hooks/useProcess.js') }}"></script>
<script src="{{ url_for('static', filename='js/templates/hooks/useTerminal.js') }}"></script>
<script src="{{ url_for('static', filename='js/templates/hooks/useWebSocket.js') }}"></script>
<!-- Your main script -->
<script src="{{ url_for('static', filename='js/transfer/transfer.js') }}"></script>
{% endblock %}